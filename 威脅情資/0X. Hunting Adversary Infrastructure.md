>[!note]
>在取得 Adversary的 IOC之後，可以採集finger print之後，利用網路空間繪測工具嘗試把Adversary所有資產的找出來。
# IOC Pivoting
>[!note]
>利用已知的一個 Indicator of Compromise（IoC），去查詢、比對、聯想，找到更多相關 IoC 或惡意行為關聯資訊的過程，就是「從一個惡意 IP，找到整個 APT 團隊的基礎設施。」
## Pivoting with SSH
>[!WARNING]
>當威脅行為者架設基礎設施時，他們可能會重複使用相同的 SSH 金鑰，或者使用的主機商本身會在多個部署中套用共同的 SSH 金鑰。

以利用chesys為例，可以抓取`service.ssh.server_host_key_fingerprint_sha256`，在View All Data裡面的`service.ssh.server_host_key_fingerprint_sha256`。

``` 
services.ssh.server_host_key.fingerprint_sha256="8d1798c27b2381fcbffb19abb5bac757052f4fa9da8b246969392c7f4a6b34fd"
```

如果確定該C2有特別運行的軟體，那就可以更進一步確認，假設80 port執行SimpleHelp會有以下banner
``` html
<title>Welcome to SimpleHelp</title>
```
可以將這個fingerprint加入搜尋
```
((services.ssh.server_host_key.fingerprint_sha256="8d1798c27b2381fcbffb19abb5bac757052f4fa9da8b246969392c7f4a6b34fd") and autonomous_system.name=`M247`) and services.http.response.html_tags="<title>Welcome to SimpleHelp</title>"
```
- 會定位autonomous_system是因為一個 AS（或同一家 ISP/主機商）會管理一段 IP 範圍。攻擊者常會在同一個主機商或同一 ASN 下佈署多台機器。以 AS 作為條件能把同一供應商下的惡意 IP 串起來，快速抓到一整片基礎設施。
## Pivoting with FTP
>[!warning]
>FTP 有執行的時候可以使用

打開"View Data"，看services.banner，可以看到 FTP的banner `220 pyftpdlib based ftpd ready.\r\n`

```
services.banner="220 pyftpdlib based ftpd ready.\r\n"
```

一樣可以用ASN來辨識 **autonomous_system.name=`LEASEWEB-APAC-SIN-11 LEASEWEB SINGAPORE PTE. LTD.`**
```
(services.banner="220 pyftpdlib based ftpd ready.\r\n") and autonomous_system.name=`LEASEWEB-APAC-SIN-11 LEASEWEB SINGAPORE PTE. LTD.`
```
## Pivoting with Executable
>[!warning]
>假設一個C2一定會有開一個web作為檔案下載使用，那可以利用host在web上面的executable作為Hunting的判斷。

假設一個C2一定有這個`http://<c2_server>:1224/pdown`，而pdown的hash是`6a104f07ab6c5711b6bc8bf6ff956ab8cd597a388002a966e980c5ec9678b5b0 `，可以利用urlscan作為列舉工具。

```
https://urlscan.io/sha256/6a104f07ab6c5711b6bc8bf6ff956ab8cd597a388002a966e980c5ec9678b5b0
```
## Pivoting with HTTP Header






















































