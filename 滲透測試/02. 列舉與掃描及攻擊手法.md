>[!章節重點]
>對網路服務(samba、web、ftp)等等做列舉，同時可以掃描服務弱點。
# 服務列舉

>[!warning] 小節重點
>利用Nmap及其他工具對網路服務列舉
## 網頁服務列舉
>[!warning ] 小節重點
>這邊資料來源是HTB academy ，目標是把Nmap所掃描出來的弱點放到其他程式去分析。
- 用nmap列舉網頁服務
``` shell-session
sudo  nmap -p 80,443,8000,8080,8180,8888,10000 --open -oA web_discovery -iL scope_list 
```
### EyeWitness
>EyeWitness是一款可以吃進去Nmap所產出的xml跟Nessus所產出的xml，並做更進一步的掃描。
- 安裝
```shell-session
sudo apt install eyewitness
```
- 使用方法
```shell-session
 eyewitness --web -x web_discovery.xml
```
### Aquatone
 - 安裝
```shell-session
wget https://github.com/michenriksen/aquatone/releases/download/v1.7.0/aquatone_linux_amd64_1.7.0.zip
```
```shell-session
unzip aquatone_linux_amd64_1.7.0.zip 
```
- 使用方法
```shell-session
cat web_discovery.xml | ./aquatone -nmap
```

## SMB Enumeration
>[!warning ] 小節重點
>可以利用enum4linux-ng (OSCP friendly)
>https://github.com/cddmp/enum4linux-ng
### nmap 掃描 
``` 
nmap -v -p 139,445 -oG smb.txt 192.168.50.1-254
```
### Windows Access SMB
```
net view \\dc01 /all
```
### Smbclient List Folder
``` 
smbclient --no-pass -L \\192.168.214.13
```
### Smbclient Access SMB
```
smbclient --no-pass //192.168.214.13/files
```
## SNMP Enumeration
> SNMP是UDP port，用 TCP scan會掃不到
### Nmap Scan 
* Nmap Scan for SNMP是UDP 
```
sudo nmap -sU --open -p 161 192.168.50.1-254 -oG open-snmp.txt
```
```bash
sudo nmap -sU --top-ports 100 $target
```
```bash
sudo nmap -sU -p161 --script *snmp* $target
```
* Nmap 對user做列舉
```
sudo nmap -n -p161 -sU --script snmp-win32-users 192.168.0.20,22
```

### snmpcheck
```
snmpcheck 192.168.214.151
```
### onesixtyone
```
onesixtyone -i snmp_ips.txt public
```
```
onesixtyone -c community -i ips
```
* onesixtyone需要使用community檔案，以下是製造community檔案的方法。 
```
echo public > community
echo private >> community
echo manager >> community
```
### snmpwalk
* 當community string 是 public
```
snmpwalk -c public -v1 -t 10 192.168.50.151
```
* 搜尋特定OID
```
snmpwalk -c public -v1 192.168.50.151 1.3.6.1.4.1.77.1.2.25
```
- 查詢`NET-SNMP-EXTEND-MIB::nsExtendOutputFull`
```
snmpwalk -v 2c -c public 192.168.240.156 NET-SNMP-EXTEND-MIB::nsExtendOutputFull
```
## SMTP Enumeration

| 名稱                         | 指令                                                                                                             | 備註                                            |
| ---------------------------- | ---------------------------------------------------------------------------------------------------------------- | ----------------------------------------------- |
| nmap                         | `sudo nmap -Pn -sV -sC -p25,143,110,465,993,995 10.129.14.128`                                                   |                                                 |
| telnet                       | `telnet 10.10.110.20 25`                                                                                         | 連上SMTP Server                                 |
| SMTP指令                     | `VRFY root` `EXPN john`                                                                                          | 驗證帳號是否存在                                |
| SMTP指令                     | `VRFY new-user`                                                                                                  | 驗證new-user帳號是否存在                        |
| SMTP指令                     | `RCPT TO:julio`                                                                                                  | identifies the recipient of the email message   |
| SMTP指令                     | `USER john`                                                                                                      |                                                 |
| O365 Spray                   | `python3 o365spray.py --validate --domain msplaintext.xyz`                                                       | 用於列舉office 365的username跟 passwor sparying |
| O365 Spray列舉user           | `python3 o365spray.py --enum -U users.txt --domain msplaintext.xyz    `                                          |                                                 |
| O365 Spray password sparying | ` python3 o365spray.py --spray -U usersfound.txt -p 'March2022!' --count 1 --lockout 1 --domain msplaintext.xyz` |                                                 |
| Hydra                        | `hydra -L users.txt -p 'Company01!' -f 10.10.110.20 pop3`                                                        |  

#### [smtp-user-enum](https://github.com/pentestmonkey/smtp-user-enum)

``` 
smtp-user-enum -M RCPT -U userlist.txt -D inlanefreight.htb -t 10.129.203.7
```

*  -M:VRFY, EXPN, RCPT
###  利用smtp寄信

``` 
swaks --from notifications@inlanefreight.com --to employees@inlanefreight.com --header 'Subject: Company Notification' --body 'Hi All, we want to hear from you! Please complete the following survey. http://mycustomphishinglink.com/' --server 10.10.11.213
```
# 弱掃

>[!warning] 小節重點
>弱掃工具有很多種，nmap具有資料庫可以做弱掃
## nmap針對443的cve2021-41773弱掃

``` 
sudo nmap -sV -p 443 --script "http-vuln-cve2021-41773" 192.168.100.1 
```
## nmap對smb作若掃
``` 
sudo nmap -script smb-vuln* -p 139,445 192.168.207.40
```
## nmap針對http弱掃

``` 
sudo nmap --script http-enum -p 80 192.168.100.1 
```
## nmap腳本弱掃

``` 
sudo nmap -sV -p 443 --script "vuln" 192.168.100.1 
```

